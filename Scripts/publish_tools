#!/bin/bash
project_root=$(dirname $(dirname "$0"))
cd $project_root
project_root=$(pwd)

rm -rf $project_root/bin

echo "Building EntityBuilder ..."
cd $project_root/Tools/BuildSystem/EntityBuilder
dotnet publish
cd $project_root
mkdir -p bin/src/EntityBuilder
cp -r Tools/BuildSystem/EntityBuilder/bin/Release/net9.0/publish/* bin/src/EntityBuilder
ln -s src/EntityBuilder/EntityBuilder bin/EntityBuilder

echo "Building ComponentBuilder ..."
cd $project_root
cmake --build build --config Release --target ComponentBuilder

echo "Building MeshBuilder ..."
cd $project_root
cmake --build build --config Release --target MeshBuilder

echo "Building MaterialBuilder ..."
cd $project_root/Tools/MaterialEditor/MaterialBuilder
dotnet publish
cd $project_root
mkdir -p bin/src/MaterialBuilder
cp -r Tools/MaterialEditor/MaterialBuilder/bin/Release/net9.0/publish/* bin/src/MaterialBuilder
ln -s src/MaterialBuilder/MaterialBuilder bin/MaterialBuilder

echo "Building PipelineBuilder ..."
cd $project_root/Tools/MaterialEditor/PipelineBuilder
dotnet publish
cd $project_root
mkdir -p bin/src/PipelineBuilder
cp -r Tools/MaterialEditor/PipelineBuilder/bin/Release/net9.0/publish/* bin/src/PipelineBuilder
ln -s src/PipelineBuilder/PipelineBuilder bin/PipelineBuilder

echo "Building InputActionCompiler ..."
cd $project_root/Tools/InputActionEditor/InputActionCompiler
dotnet publish
cd $project_root
mkdir -p bin/src/InputActionCompiler
cp -r Tools/InputActionEditor/InputActionCompiler/bin/Release/net9.0/publish/* bin/src/InputActionCompiler
ln -s src/InputActionCompiler/InputActionCompiler bin/InputActionCompiler

echo "Building LiveLink.Ping ..."
cd $project_root/Tools/LiveLink/LiveLink.Ping
dotnet publish
cd $project_root
mkdir -p bin/src/LiveLink.Ping
cp -r Tools/LiveLink/LiveLink.Ping/bin/Release/net9.0/publish/* bin/src/LiveLink.Ping
ln -s src/LiveLink.Ping/LiveLink.Ping bin/LiveLink.Ping

echo "Building LiveLink.ReloadAsset ..."
cd $project_root/Tools/LiveLink/LiveLink.ReloadAsset
dotnet publish
cd $project_root
mkdir -p bin/src/LiveLink.ReloadAsset
cp -r Tools/LiveLink/LiveLink.ReloadAsset/bin/Release/net9.0/publish/* bin/src/LiveLink.ReloadAsset
ln -s src/LiveLink.ReloadAsset/LiveLink.ReloadAsset bin/LiveLink.ReloadAsset
